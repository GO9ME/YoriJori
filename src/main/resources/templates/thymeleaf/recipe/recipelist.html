<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{thymeleaf/layout/mainLayout}">
<!-- include summernote css/js-->
<!-- <link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css"
	integrity="sha256-2XFplPlrFClt0bIdPgpz8H7ojnk10H69xRqd9+uTShA="
	crossorigin="anonymous" /> -->
<th:block layout:fragment="header">
	<link rel="stylesheet" href="/yorijori/common/css/recipe/recipelist.css">
	<script type="text/javascript">

</script>

</th:block>
<th:block layout:fragment="content">
	<div>

		<div class="container">
			<h3 class="menu-h3-common">레시피 목록</h3>
			<div class="row">
				<div class="col-lg-3">
					<div class="sidebar">

						<div class="widget border-0">
							<!-- 검색 창 init -->
							<div id="searbar_ingredient" th:insert="~{thymeleaf/common/search :: searchbar('레시피를 입력해주세요','inputSearchData','searchIngredient')}"></div>
						</div>
						<form action="" method="post">
							<div class="widget border-0">
								<div class="apply job-alert-bt mr-3" style="text-align: center;">
									<a class="btn btn-md btn-dark" href="#">
										<i class="fa-regular fa-circle-check"></i> 필터 적용
									</a>
								</div>
							</div>

							<div class="widget">

								<div class="widget-title widget-collapse">
									<h6>레시피</h6>
									<a class="ml-auto" data-toggle="collapse" href="#gender" role="button" aria-expanded="false" aria-controls="gender">
										<i class="fas fa-chevron-down"></i>
									</a>
								</div>
								<div class="collapse show" id="gender">
									<div class="widget-content">
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="user_recipe_check">
											<label class="custom-control-label" for="user_recipe_check">유저 레시피</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="server_recipe_check">
											<label class="custom-control-label" for="server_recipe_check">공식 레시피</label>
										</div>
									</div>
								</div>
							</div>
							<div class="widget">
								<div class="widget-title widget-collapse">
									<h6>필터</h6>
									<a class="ml-auto" data-toggle="collapse" href="#dateposted" role="button" aria-expanded="false" aria-controls="dateposted">
										<i class="fas fa-chevron-down"></i>
									</a>
								</div>
								<div class="collapse show" id="dateposted">
									<div class="widget-content">
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="볶음" id="dateposted10">
											<label class="custom-control-label" for="dateposted10">볶음</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="찜" id="dateposted11">
											<label class="custom-control-label" for="dateposted11">찜</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="끓임" id="dateposted12">
											<label class="custom-control-label" for="dateposted12">끓임</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="조림" id="dateposted13">
											<label class="custom-control-label" for="dateposted13">조림</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="튀김" id="dateposted15">
											<label class="custom-control-label" for="dateposted15">튀김</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="굽기" id="dateposted16">
											<label class="custom-control-label" for="dateposted16">굽기</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="부침" id="dateposted17">
											<label class="custom-control-label" for="dateposted17">부침</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="부침" id="dateposted18">
											<label class="custom-control-label" for="dateposted18">볶음</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="부침" id="dateposted19">
											<label class="custom-control-label" for="dateposted19">면류</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="부침" id="dateposted20">
											<label class="custom-control-label" for="dateposted20">찌개류</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="부침" id="dateposted21">
											<label class="custom-control-label" for="dateposted21">고기</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="recipe" value="부침" id="dateposted22">
											<label class="custom-control-label" for="dateposted22">분식</label>
										</div>
									</div>
								</div>
							</div>
							<div class="widget">
								<div class="widget-title widget-collapse">
									<h6>인분</h6>

									<a class="ml-auto" data-toggle="collapse" href="#jobtype" role="button" aria-expanded="false" aria-controls="jobtype">

										<i class="fas fa-chevron-down"></i>
									</a>
								</div>
								<div class="collapse show" id="jobtype">
									<div class="widget-content">
										<div class="custom-control custom-checkbox fulltime-job">

											<input type="checkbox" class="custom-control-input dateposted" name="serving" value="1인분" id="menutype1" onclick="handleMenutype(this)">
											<label class="custom-control-label" for="menutype1">1인분</label>
										</div>
										<div class="custom-control custom-checkbox parttime-job">
											<input type="checkbox" class="custom-control-input dateposted" name="serving" value="2인분" id="menutype2" onclick="handleMenutype(this)">
											<label class="custom-control-label" for="menutype2">2인분</label>
										</div>
										<div class="custom-control custom-checkbox freelance-job">
											<input type="checkbox" class="custom-control-input dateposted" name="serving" value="3인분" id="menutype3" onclick="handleMenutype(this)">
											<label class="custom-control-label" for="menutype3">3인분</label>
										</div>
										<div class="custom-control custom-checkbox freelance-job">
											<input type="checkbox" class="custom-control-input dateposted" name="serving" value="4인분" id="menutype4" onclick="handleMenutype(this)">
											<label class="custom-control-label" for="menutype4">4인분</label>

										</div>
									</div>
								</div>
							</div>
							<div class="widget">
								<div class="widget-title widget-collapse">
									<h6>조리 시간</h6>

									<a class="ml-auto" data-toggle="collapse" href="#experience" role="button" aria-expanded="false" aria-controls="experience">

										<i class="fas fa-chevron-down"></i>
									</a>
								</div>
								<div class="collapse show" id="experience">
									<div class="widget-content">
										<div class="custom-control custom-checkbox">

											<input type="checkbox" class="custom-control-input dateposted" name="min" value="15분" id="experience2" onclick="handleExperience(this)">
											<label class="custom-control-label" for="experience2">15분</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="min" value="30분" id="experience3" onclick="handleExperience(this)">
											<label class="custom-control-label" for="experience3">30분</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="min" value="45분" id="experience4" onclick="handleExperience(this)">
											<label class="custom-control-label" for="experience4">45분</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="min" value="60분" id="experience5" onclick="handleExperience(this)">
											<label class="custom-control-label" for="experience5">60분</label>

										</div>
									</div>
								</div>
							</div>
							<div class="widget">
								<div class="widget-title widget-collapse">
									<h6>나라별 음식</h6>

									<a class="ml-auto" data-toggle="collapse" href="#Offeredsalary" role="button" aria-expanded="false" aria-controls="Offeredsalary">
										<i class="fas fa-chevron-down"></i>

									</a>
								</div>
								<div class="collapse show" id="Offeredsalary">
									<div class="widget-content">
										<div class="custom-control custom-checkbox">

											<input type="checkbox" class="custom-control-input dateposted" name="country" value="한식" id="likeCount1" onclick="handleLikeCount(this)">
											<label class="custom-control-label" for="likeCount1">한식</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="country" value="중식" id="likeCount2" onclick="handleCheckboxChange(this)">
											<label class="custom-control-label" for="likeCount2">중식</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="country" value="일식" id="likeCount3" onclick="handleCheckboxChange(this)">
											<label class="custom-control-label" for="likeCount3">일식</label>
										</div>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input dateposted" name="country" value="양식" id="likeCount4" onclick="handleCheckboxChange(this)">
											<label class="custom-control-label" for="likeCount4">양식</label>

										</div>
									</div>
								</div>
							</div>

							<div class="widget border-0">
								<div class="widget-add">
									<!-- <img class="img-fluid" src="images/add-banner.png" alt=""> -->
								</div>
							</div>
						</form>
					</div>
				</div>
				<div class="col-lg-9">
					<div class="job-filter mb-4 d-sm-flex align-items-center">
						<div class="job-alert-bt mr-3">
							<a class="btn btn-md btn-dark" href="/yorijori/recipe/insert">
								<i class="fa-solid fa-utensils"></i>ㅤ레시피 등록
							</a>
						</div>
						<div class="job-alert-bt mr-3">
							<a class="btn btn-md btn-dark" href="/yorijori/recipe/list/user/0">
								<i class="fa-solid fa-rotate-right"></i>ㅤ필터 초기화
							</a>
						</div>
						<div class="job-alert-bt mr-3">
							<div class="custom-control custom-checkbox">
								<input type="checkbox" class="custom-control-input dateposted" name="order" value="viewed" id="dateposted1">
								<label class="custom-control-label" for="dateposted1">조회수 순</label>
							</div>
						</div>
						<div class="job-alert-bt mr-3">
							<div class="custom-control custom-checkbox">
								<input type="checkbox" class="custom-control-input dateposted" name="order" value="great" id="dateposted2">
								<label class="custom-control-label" for="dateposted2">좋아요 순</label>
							</div>
						</div>
						<div class="job-alert-bt mr-3">
							<div class="custom-control custom-checkbox">
								<input type="checkbox" class="custom-control-input dateposted" name="order" value="comments" id="dateposted3">
								<label class="custom-control-label" for="dateposted3">댓글 많은 순</label>
							</div>
						</div>
						<div class="job-alert-bt mr-3">
							<div class="custom-control custom-checkbox">
								<input type="checkbox" class="custom-control-input dateposted" name="order" value="registration" id="dateposted4">
								<label class="custom-control-label" for="dateposted4">등록 순</label>
							</div>
						</div>
						<div class="job-shortby ml-sm-auto d-flex align-items-center"></div>
					</div>

					<div class="row recipe_content" id="results">
						<th:block th:if="${type} == 'user'">
							<div class="col-sm-6 col-lg-4 mb-4" th:each="data, idx : ${list}">

								<div class="candidate-list candidate-grid ">
									<div class="candidate-list-image">
										<!-- 								    <img class="img-fluid" th:src="@{'/images/'+${recipe.thumbnail}}" alt=""> -->
										<img class="img-fluid" th:src='|/yorijori/data/recipethumbnail/${data.thumbnail}|' alt="">
									</div>

									<div class="candidate-list-details">
										<div class="candidate-list-info">
											<div class="candidate-list-title">
												<h5>

													<a th:href="@{/recipe/view/user/{recipeNo}(recipeNo=${data.recipeNo})}" th:text="${data.name}"></a>
												</h5>
											</div>
											<div class="candidate-list-option">
												<div class="badge badge-dark px-3 rounded-pill font-weight-normal" th:text="'작성자 ' + ${data.userId.nickname}" th:data-userid="${data.userId.userId}"></div>
												<br>
												<div class="badge badge-success px-3 rounded-pill font-weight-normal" th:text="${data.time}"></div>
												<th:block>
												    <div class="badge badge-danger px-3 rounded-pill font-weight-normal">
												       ★[[${data.average}]]점
												    </div>
												</th:block>
											</div>
										</div>
										<div class="candidate-list-favourite-time justify-content-around">
											<ul class="list-unstyled list-inline">
												<li class="pr-2"><a class="recipe_info_data order-2">

														<i class="far fa-comments pr-1"> [[${#lists.size(data.reviewlist)}]]</i>
													</a></li>
												<li class="pr-2"><a class="recipe_info_data order-2">
														<i class="fa-regular fa-eye"> [[${data.count}]]</i>
													</a></li>
												<th:block th:if="${!#strings.isEmpty(session.userInfo)}">

<!-- 													<li class="pr-2"><a th:class="${#lists.size(data.wishlist) == 0 ?'candidate-list-favourite order-2 black_heart':'candidate-list-favourite order-2 red_heart'}" th:value="${data.recipeNo}" onclick="clickHeart(this,addHeart)"> -->
													<li class="pr-2"><a class="candidate-list-favourite order-2 black_heart" th:id="|wishNo${data.recipeNo}|" th:value="${data.recipeNo}" onclick="clickHeart(this,addHeart)">
															<i class="fa fa-heart me-2" aria-hidden="true"></i>
														</a></li>

												</th:block>
											</ul>

										</div>
									</div>
								</div>
							</div>
						</th:block>
						<th:block th:unless="${type} == 'user'">
							<div class="col-sm-6 col-lg-4 mb-4" th:each="data, idx : ${list}">
								<div class="candidate-list candidate-grid">
									<div class="candidate-list-image">
										<img class="img-fluid" th:src="${data.attFileNoMain}" alt="">
									</div>
									<div class="candidate-list-details">
										<div class="candidate-list-info">
											<div class="candidate-list-title">
												<h5>
													<a th:href="@{/recipe/view/server/{rcpSeq}(rcpSeq=${data.rcpSeq})}">[[${data.rcpNm}]]</a>
												</h5>
											</div>
											<div class="candidate-list-option">
												<div class="badge badge-danger px-3 rounded-pill font-weight-normal">[[${data.rcpPat2}]]</div>
												<div class="badge badge-danger px-3 rounded-pill font-weight-normal">
												       ★[[${recipeNoAverageMap.get(data.rcpSeq)}]]점
												    </div>
												<br>
												<ul class="list-unstyled"></ul>
											</div>
										</div>
										<div class="candidate-list-favourite-time text-center pt-3 justify-content-around">
											<ul class="list-unstyled list-inline">
												<li class="pr-2"><a class="recipe_info_data order-2">
														<i class="far fa-comments pr-1"> [[${#lists.size(data.reviewList)}]]</i>

													</a></li>
												<li class="pr-2"><a class="recipe_info_data order-2">
														<i class="fa-regular fa-eye"> [[${data.count}]]</i>

													</a></li>
												<th:block th:if="${!#strings.isEmpty(session.userInfo)}">
													<li class="pr-2"><a th:class="${#lists.size(data.wishlist) == 0 ?'candidate-list-favourite order-2 black_heart':'candidate-list-favourite order-2 red_heart'}" th:value="${data.rcpSeq}" onclick="clickHeart(this,addHeart)">
															<i class="fa fa-heart me-2" aria-hidden="true"></i>
														</a></li>
												</th:block>
											</ul>
											<!-- <span class="candidate-list-time order-1"><i class="far fa-solid fa-utensils pr-1" aria-hidden="true"></i>[[${data.recipeDes}]]</span> 
											<span class="candidate-list-time order-1"><i class="far fa-regular fa-eye pr-1" aria-hidden="true">[[${data.count}]]</i></span> -->
										</div>
									</div>
								</div>
							</div>
						</th:block>

					</div>
					<div class="row">
						<div class="col-12 text-center mt-4 mt-sm-5">
							<div id="pag">
								<nav th:insert="~{thymeleaf/common/pagination :: pagination}"></nav>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script th:inline="javascript">
		let pageNo = 0;
		// 한번에 보여줄 페이지
		let pagePerCount = 9;
		// 현재 페이지 
		let currentPage = [[${pageNo}]];
		// 타입 ( 서버 or 유저 )
		const type = [[${type}]];
		
		// recipe 카운트
		let userRecipeCount = [[${count}]];
		// pagination 들어갈 div
		const $pagination = $('#pagination_div');
		
		
		// 총 페이지지 네이션 수 
		let totalPages = 1;
		if ( userRecipeCount > pagePerCount ){
			totalPages = Math.ceil( userRecipeCount/pagePerCount )
		}
		var defaultOpts = {
		        totalPages: totalPages
	    };
		
		$(document).ready(function() {
			//공식 레시피 클릭
			if ( type == "user"){
				$('#user_recipe_check').prop('checked', true);
			} else {
				$('#server_recipe_check').prop('checked', true);
			}
			
			$('#server_recipe_check').click(function() {
				console.log(this.checked);
				if (this.checked) {
					$("#user_recipe_check").prop('checked', false);
					window.location.href = "/yorijori/recipe/list/server/0";
				}
			})

			// 유저레시피 필터 클릭
			$("#user_recipe_check").click(function() {
				window.location.href = "/yorijori/recipe/list/user/0";
			})
			
			if (type == 'user'){ // 유저 레시피 페이징 
				makePagination($pagination, totalPages, pagePerCount, currentPage + 1, move_list);
			} else { // 서버 레시피 페이징
				makePagination($pagination, totalPages, pagePerCount, currentPage + 1, move_list_api);
			}
	
			console.log([[${wishlist}]])
			const wishlist = [[${wishlist}]]
			const rcplist = [[${list}]]
			if (rcplist != null && wishlist != null){
				for ( let i = 0 ; i < rcplist.length ; i ++ ) {
					for ( let j = 0 ; j < wishlist.length; j++){
						if ( rcplist[i].recipeNo == wishlist[j].recipeNo.recipeNo){
							$("#wishNo"+rcplist[i].recipeNo).removeClass('black_heart')
							$("#wishNo"+rcplist[i].recipeNo).addClass('red_heart')
						}
						
					}
				}
				
				
			}
			
		});
	

		
		const addHeart = function(data){
			let value = $(data).attr('value');
			let heartUrl = "/yorijori/recipe/like/"+ type +"/" +value;
			//setTimeout(() => window.location.href=heartUrl, 2000);
			getAjaxNoParam(heartUrl, function(data){
				console.log(data);
			})
			let clickdata = $(data);
			console.log(clickdata);
			if (clickdata.hasClass('red_heart')) {
			  clickdata.removeClass('red_heart');
			  clickdata.addClass('black_heart');
			} else {
				clickdata.removeClass('black_heart');
				clickdata.addClass('red_heart');
			}
		}
		

		$('.badge.badge-dark.px-3.rounded-pill.font-weight-normal').on('click', function() {
			 var userId = $(this).data('userid');
			    
			    $.ajax({
			        url: '/yorijori/user/' + userId,
			        type: 'GET',
			        contentType: 'application/json',
			        success: function(response) {
			        	
			        	var imagePath = "/yorijori/data/user/" + response.imgPath;
			            
			            // 이미지를 표시할 HTML 코드
			            var imageHtml = '<div class="image-container"><img class="rounded-circle mt-2" style="width: 10em; height: 10em; margin-bottom: 1em;"'
              + ' src="' + imagePath + '"></div>';
			            
              var userInfoHtml = `
  				<div class="col-md">
  					<div class="d-flex flex-column align-items-center text-center p-3 py-2">
  						${imageHtml}
  						<span class="font-weight-bold">${response.nickname}</span>
  						<!-- 유저 평점에 따라 이미지를 바꿔줄 것 -->
  						<div>
  							<img src="/yorijori/images/userpoint/${response.point}tier.png" style="width: 4em; height: 4em;">
  						</div>
  						<br/>
  						<span id="purpose">${response.purpose}</span>
  					</div>
  				</div>`;

  						$('.showuserinfo').empty().append(userInfoHtml);
			            // .showuserinfo 요소에 이미지 코드 추가
			           
			        	    
			        	    $('#profilecardmodal').modal('show');
			        },
			        error: function(xhr, status, error) {
			            // 오류 처리
			        }
			    });
			});

		// 검색 버튼 클릭 시 
		$('#searchIngredient').click(function(){
			fnSearch();
		})
		
		// 검색 함수
		const fnSearch = function(){
			let searchData = $("#inputSearchData").val();
			let url = "/yorijori/recipe/search";
			currentPage = 0 ;
			window.location.href = url + "/" + searchData + "/" + currentPage;
		}



	</script>
	<script th:inline="javascript">
	$(document).ready(function () {
	    $('.apply a.btn').on('click', function (e) {
	        e.preventDefault();
	        var selectedCheckboxes = {};

	        $('.custom-control-input.dateposted:checked').each(function () {
	            var checkboxValue = $(this).val();
	            var checkboxName = this.name;

	            if (selectedCheckboxes[checkboxName] === undefined) {
	                selectedCheckboxes[checkboxName] = [];
	            }	
	            selectedCheckboxes[checkboxName].push(checkboxValue);            
	        });
	        $.ajax({
	            url: '/yorijori/recipe/filtersearch',
	            type: 'post',
	            contentType: 'application/json; charset=utf-8',
	            dataType: 'json',
	            data: JSON.stringify(selectedCheckboxes),
	            error: function () {
	                alert('검색에 실패했습니다.');
	            },
	            success: function (response) {

	                $('#results').empty();
	                response.recipes.forEach(function (recipe) {
	                	
	                	var userinfo = $('#userinfo').val()
	                	console.log(userinfo);
						console.log(recipe)
						if(userinfo){
							heartElement = `
			                    <li class="pr-2"><a class="" value="${recipe.recipeNo}" onclick="clickHeart(this, addHeart)">
		                        <i class="fa fa-heart me-2" aria-hidden="true"></i>
		                    </a></li>
		                `;				
							
						}else{
							heartElement =``
						}
						
						
	                    const content = `
	                        <div class="col-sm-6 col-lg-4 mb-4">
	                        <div class="candidate-list candidate-grid">
	                        <img class="img-fluid" src="/yorijori/data/recipethumbnail/${recipe.thumbnail}" alt="">
	                        <div class="candidate-list-details">
	                            <div class="candidate-list-info">
	                                <div class="candidate-list-title">
	                                    <h5>
	                                      <a href="/yorijori/recipe/view/user/${recipe.recipeNo}">${recipe.name}</a>
	                                    </h5>
	                                </div>
	                                <div class="candidate-list-option">
	                                <div class="badge badge-dark px-3 rounded-pill font-weight-normal">${recipe.userNickname}</div>
	                                    <br>
	                                    <div class="badge badge-success px-3 rounded-pill font-weight-normal">${recipe.time}</div>
	                                    <div class="badge badge-danger px-3 rounded-pill font-weight-normal">4.22</div>
	                                </div>
	                            </div>
	                            <div class="candidate-list-favourite-time justify-content-around">
	                                <ul class="list-unstyled list-inline">
	                                    <li class="pr-2"><a class="recipe_info_data order-2">
	                                            <i class="far fa-comments pr-1">${recipe.reviewlist.length}</i>
	                                        </a></li>
	                                    <li class="pr-2"><a class="recipe_info_data order-2">
	                                            <i class="fa-regular fa-eye"> ${recipe.count}</i>
	                                        </a></li>
	                                        ${heartElement}
	                                </ul>
	                            </div>
	                        </div>
	                    </div>
	                </div>`;
	                    $('#results').append(content);
	                });
	            }
	        });
	    });
	});
	</script>
	<script src="/yorijori/common/js/recipe/list.js"></script>
</th:block>
</html>
<!-- 	                                <div class="badge badge-dark px-3 rounded-pill font-weight-normal">/* ${recipe.uesrId.Nickname} */ </div> -->
